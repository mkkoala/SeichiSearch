<%= link_to user_path(@mecca.user), class: "pull-right" do %>
	<nobr>(<%= @mecca.user.name %>　さんの投稿)</nobr>
	<%= attachment_image_tag(@mecca.user, :profile_image, :fill, 50, 50, fallback: "no_image.jpg") %><br>
<% end %>

<!-- イメージ画像 -->
<%= attachment_image_tag(@mecca, :mecca_image, :fill, 300, 300, fallback: "no_image_2.jpg") %>

<!-- 場所名 -->
<h3><%= @mecca.name %></h3>

<!-- 説明 -->
<p><%= @mecca.body %></p>


<% @mecca.meccas_movie_tags.each do |meccas_movie_tags| %>
	<%= link_to movie_tag_path(meccas_movie_tags.movie_tag.id) do %>
		<p class="label label-default">
			<span class="glyphicon glyphicon-tag" aria-hidden="true"></span>　<%= meccas_movie_tags.movie_tag.title %>
		</p>
	<% end %>
<% end %>



<p>いいね数　<%= @mecca.favorites.count %>件</p>


<% if @mecca.favorited_by?(current_user) %>
  	<%= link_to mecca_favorites_path(@mecca), class: "btn-sm btn-warning", method: :delete do %>
	  <i class="fa fa-heart" aria-hidden="true" style="color: red;"></i>
	  いいねを解除する
	<% end %>
<% else %>
	 <%= link_to mecca_favorites_path(@mecca), class: "btn-sm btn-warning", method: :mecca do %>
	  <i class="fa fa-heart-o" aria-hidden="true"></i>
	  いいねに追加する
	<% end %>
<% end %>



<% if user_signed_in? && @mecca.user.id == current_user.id %>
	<%= link_to "編集する",edit_mecca_path(@mecca), class: "btn-sm btn-success edit_mecca_#{@mecca.id}" %>
	<%= link_to "削除する",@mecca, method: :delete, data: {confirm: "本当に削除してもよろしいですか？"}, class: "btn-sm btn-danger" %>
<% end %>

<!-- 郵便番号 -->
<h4>〒 <%= @mecca.post_code %></h4>

<!-- 住所 -->
<h4><%= @mecca.address %></h4>



<!-- マップ表示部分 -->
	<div id="map" style="width:620px; height:400px"></div>

    <script>
	function initMap() {

	  var target = document.getElementById('map'); //マップを表示する要素を指定
	  var address = '岐阜県高山市城山156'; //住所を指定
	  var geocoder = new google.maps.Geocoder();

	  geocoder.geocode({ address: address }, function(results, status){
	    if (status === 'OK' && results[0]){

	      console.log(results[0].geometry.location);

	       var map = new google.maps.Map(target, {
	         center: results[0].geometry.location,
	         zoom: 15
	       });

	       var marker = new google.maps.Marker({
	         position: results[0].geometry.location,
	         map: map,
	         animation: google.maps.Animation.DROP
	       });

	    }else{
	      //住所が存在しない場合の処理
	      alert('住所が正しくないか存在しません。');
	      target.style.display='none';
	    }
	  });
	}
	</script>
	<script src="//maps.google.com/maps/api/js?key=AIzaSyA3uyk_GS67ltFpMTIxNzst0BBi3NTaQ4E&callback=initMap"></script>
<!-- マップ表示部分 -->



<!-- コメント入力フォーム -->
<%= form_for @mecca_comment, url: mecca_mecca_comments_path(@mecca.id), method: :post do |f| %>
    <div class="row">
        <div class="col-sm-12">
            <%= f.text_area :comment, rows:'5', class: "form-control",placeholder: "コメントをここに" %>
        </div>
    </div>
    <%= f.submit "送信する", class: "pull-right" %>
<% end %>
<!-- コメント入力フォーム -->



<!-- コメント一覧 -->
<table class="table">
	<% @mecca.mecca_comments.each do |mecca_comment| %>
        <tr class="comment">
            <div class="comment-body bb">
            <td>
	            <div class="comment-avatar">
	              <div class="avatar">
	                <%= attachment_image_tag mecca_comment.user, :profile_image, :fill, 60, 60, fallback: "no_image.jpg" %>
	              </div>
	            </div>
	        </td>
	        <td>
	            <div class="comment-text">
		            <div class="comment-author clearfix">
		                <%= link_to mecca_comment.user.name,user_path(mecca_comment.user) %></a>
		                <span class="comment-meta">
		                  <span class="comment-date"><%= mecca_comment.created_at.strftime('%Y/%m/%d') %></span>
		                </span>
		            </div>
		            <div class="comment-entry"><%= mecca_comment.comment %></div>
	            </div>
	        </td>
	        <td>
	            <% if user_signed_in? && mecca_comment.user.id == current_user.id %>
	            <div class="comment-destroy">
	            	<%= link_to "削除する",mecca_mecca_comments_path(@mecca.id), method: :delete, data: {confirm: "本当に削除してもよろしいですか？"}, class: "btn-sm btn-danger" %>
	            </div>
	            <% end %>

            </div>
        	</td>
        </tr>
    <% end %>
</table>
<!-- コメント一覧 -->


